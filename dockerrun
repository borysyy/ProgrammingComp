#!/usr/bin/env fish

# Checking if username was entered
if [ (count $argv) -lt 1 ]
    echo "Usage: $argv[0] <username> [<usedefaultpasswd>]"
    exit 1
else if [ (count $argv) -gt 2 ]
    echo "Usage: $argv[0] <username> [<usedefaultpasswd>]"
    exit 1
end

# Username argument
username="$1"
defaultpasswd="$2"

# Port variable
PORT=2200

# Check if the port is open
while true; do
nc -zv localhost $PORT > /dev/null 
    # If not go to the next one
    if [ $? -eq 0 ]; then
    PORT=$(expr $PORT + 1)
    else
        break
    end
end 

set userdirectory (realpath ~/Desktop/ProgrammingComp/Submissions/$username)

if not test -d $userdirectory
    # If it doesn't exist, create it
    mkdir -p $userdirectory
end

# Printing that the container was successful 
echo "Running $username's container"
<<<<<<< HEAD
=======

# Printing what port you're using
>>>>>>> cd6e9c49d53329f025ad3266835dd74d535de40c
echo "Using port $PORT"

# Running the Docker image
docker run -t -v ~/Desktop/ProgrammingComp/Problems:/problems:ro -v $userdirectory:/submissions -e USER=$username -e DEFAULTPASSWD=$defaultpasswd -p $PORT:22 users 
