<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Execution</title>
</head>

<body>
    <div style="text-align: center;">
        <h1>Upload and Execute Code</h1>
        <form action="/execute" method="post" enctype="multipart/form-data" id="code-form">
            <label for="username">Username:</label>
            <input type="text" name="username" id="username">
            <br>
            <label for="file">File:</label>
            <input type="file" name="file" id="file">
            <br>
            <input type="submit" value="Submit">
        </form>

    </div>

    <!-- Add a section to display the code execution results -->
    <div style="text-align: center;">
        <h2>Code Execution Results</h2>
        <pre id="output" style="white-space: pre-wrap;"></pre>
    </div>



    <script>

        /* Event listener attatched to a form with the id code-form. It listens for a form
            submission event and, upon submission, makes an HTTP POST request to a server endpoint,
            using the Fetch API. 
        */

        // Attatches an event listener to the submit event of the form with the id code-form.
        // When the form is submitted, the event listener is triggered
        document.getElementById('code-form').addEventListener('submit', function (event) {

            // Prevents the default form submission behavior, which would typically cause the page
            // to reload. It allows you to handle the form submission using JS.
            event.preventDefault();

            // Creates a FormData object by extracting the form data from the code-form element.
            // This allows you to easily collect and send form input values as part of the HTTP request.
            const formData = new FormData(document.getElementById('code-form'));

            // Uses the fetch function to send an HTTP POST request to that link. 
            // The fetch function returns a promise that resolves to the response from the 
            // server.
            fetch('http://localhost:3000/execute', {
                method: 'POST',
                body: formData,
            })
                // Processes the response from the server. It first converts the response to
                // JSON format. The response.json() method returns a promise, so you can chain
                // another then() to work with the actual JSON data received from the server. 
                .then(response => response.json())

                // Processes the JSON data received from the server. It sets the text context
                // of an HTML element with the id output to the data.output value. It assumes
                // that the server response contains a property named output and it updates the DOM
                // (Document Object Model - Allows you to access and manipulate the document's content
                // and structure using JavaScript)
                // with the received output. 
                .then(data => {
                    document.getElementById('output').innerText = data.output;
                })

                // If there is an error during the HTTP request or JSON parsing, this code handles the 
                // error by setting the text content of the output element to display an error message.
                .catch(error => {
                    document.getElementById('output').innerText = 'An error occurred: ' + error.message;
                });
        });
    </script>


</body>

</html>